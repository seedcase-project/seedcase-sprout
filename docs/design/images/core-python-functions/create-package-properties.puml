@startuml create-package-properties
!theme seedcase from https://raw.githubusercontent.com/seedcase-project/seedcase-theme/main

state "Input" as input {
  input : - `path_*()` functions assist with giving correct paths
' Arguments -----
  path : - Path to `datapackage.json` file\n  in the package `<id>` folder
  properties: - JSON object of the package\n  following the Data Package spec
}

state "Output" as output {
  state "JSON" as json_output
  json_output : - JSON object of the package following\n  the Data Package spec
  json_output : - Use `write_package_properties()` to\n  save back to `datapackage.json`
}

state "create_package_properties()" as cps {
  cps : - Required arg: path and properties

  state arg_path <<entryPoint>>
  state arg_properties <<entryPoint>>

  path --> arg_path
  properties --> arg_properties

  state "verify_is_file()" as vif
  vif : - Required arg: path
  vif : - Output: path or Error
  arg_path --> vif : path object

  state "verify_package_properties()" as vpp
  vpp : - Required arg: properties
  vpp : - Output: JSON or Error
  vpp : - Checks against spec
  arg_properties --> vpp : JSON object

  state "read_properties()" as rp
  rp : - Required arg: path
  rp : - Output: JSON
  vif --> rp : path object

  state "join_properties()" as jp
  jp : - Required args: current_properties and new_properties
  jp : - Output: JSON
  rp --> jp : JSON object
  vpp --> jp

  state "return" <<exitPoint>>
  jp --> return : JSON object
  return --> output
}

@enduml
