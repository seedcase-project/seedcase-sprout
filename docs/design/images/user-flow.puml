@startuml user-flow

title Entire User Flow of Sprout

:User selects option to "Upload Data";
if (\nSystem shows data upload\nUI with option to create new\nschema or use existing one\n) then (Create New Schema)
  :User selects\n"Create New Schema";
  switch (System shows create schema UI)
    case (Create Schema\nfrom File)
      :User selects
      "Create Schema
      from File";
      :System shows UI
      with file upload;
      :User selects file and
      clicks "Create Schema";
      :System loads file and
      attempts to extract 
      headers and definitions*;
    case (Create Schema from\nExisting Schema)
      :User selects
      "Create New Schema
      from Existing Schema";
      :System shows list of
      existing schemas;
      :User inspects schemas
      and selects base schema;
    case (Create Schema Manually)
      :User selects
      "Create Schema Manually";
      :System shows UI where
      user can create schema manually;
      :User adds headers
      and definitions;
      :User clicks "Save
      and Submit Schema";
    endswitch
    #palegreen:Initial schema has been created;
   while (\nVALIDATION CHECK: Schema Completeness\nSystem checks that schema has name\nand that all headers have definitions*\n) is (Validation failed)
    :System shows "Validation failed"
    and shows UI with schema for 
    user to edit, including: 
    - headers (textbox)
    - textbox for description (textbox)
    - data type (dropdown)
    - nullable (boolean), and 
    - title (optional textbox)
    - option to "Add field"
    Missing fields are highlighted;
    :User completes/edits schema;
    if (System asks user if they want to save only or submit) then (Save only)
      :User clicks "Save Draft";
      end
    else (Save and Submit)
      :User clicks "Save and Submit Schema";
      label l
    endif
  end while (Validation successful)
  :System shows UI with schema for user confirmation;
  while (User decides whether schema is correct or needs editing) is (Incorrect schema)
    :User clicks "Edit Schema";
    :System shows UI with schema for 
    user to edit, including: 
    - headers (textbox)
    - textbox for description (textbox)
    - data type (dropdown)
    - nullable (boolean), and 
    - title (optional textbox)
    - option to "Add field";
    :User edits schema;
    :User clicks "Continue";
    goto l
   end while (Correct schema)
   :User clicks "Save and Submit Schema";
    #palegreen:Systems confirms: "New Schema added Successfully";
  if (System asks user if they want to upload data) then (No)
    :User "quits" Sprout; 
    end
  else (Yes)
    :User clicks "Continue to Data Upload";
  endif
else (Use Existing Schema)
    :User selects\n"Use Existing Schema";
    :System shows UI with existing schemas 
    to choose from and file upload;
    :User selects existing schema and 
    selects file to upload;
    :User clicks "Continue to Data Upload";
endif 
:System initialises data upload;
while (\nVALIDATION CHECK: Check if Schema and data match\n) is (Validation failed)
  :Systems shows "Upload Failed" along\nwith description on where data and\nschema do not match;
    while (User decides if they want to continue upload) is (No)
        :User clicks "Cancel Upload";
        end
    end while (Yes);
  #LightBlue:User edits file and attempts to fix errors\noutside of Sprout;
  :User clicks "Upload Edited/New Version of File";
  :System shows UI where user can add file; 
  :User selects file and clicks "Upload File";
end while (Validation successful);
while (\nSystem displays the number of \nsuccessfully validated rows \nto the user for agreement\n) is (No)
  :User clicks "Cancel Upload";
  end
end while (Yes);
:User confirms by clicking: "Confirm Number\nof Rows to Upload and Upload Data";
#palegreen:System displays confirmation: "Upload Successful";

footer \n*Definition includes the header (column name), data type, description (sentence describing what is in the variable),\nis-nullable (boolean), and an optional title (reader friendly column name).\nExample:\nheader = "adr1",\ndata type = varchar,\ndescription = "first address line of patient's address",\nis-nullable = 0, \ntitle (optional): "address line 1"
@enduml
