{% extends 'includes/base.html' %}

{% block content %}

<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Description</th>
      <th>Data Rows</th>
      <th>Date Created</th>
      <th>Last Upload</th>
    </tr>
  </thead>
  {% for metadata in existing_metadata %}
  <tbody>
    <tr class="selectable" id="{{metadata.id}}" onclick="rowSelected(event.target.parentElement)">
      <td>{{metadata.name}}</td>
      <td>{{metadata.description}}</td>
      <td>Cell</td>
      <td>{{metadata.created_at}}</td>
      <td>Cell</td>
    </tr>
  </tbody>
  {% empty %}
  <p>No existing data to show.</p>
  {% endfor %}
</table>

<!-- Create metadata dialog -->
{% include 'includes/metadata-create-dialog.html' %}

<!-- three buttons will submit this form: create, edit, or upload -->
<nav class="right-align">
  <a class="button" data-ui="#create-metadata-dialog"><i>add</i>Create new metadata</a>
  <a href="#" class="button" id="edit-link" disabled><i>edit</i>Edit metadata</a>
  <a href="#" class="button" id="upload-link" disabled><i>upload</i>Upload data</a>

</nav>

<script>
  let edit_url = "{% url 'column-review' table_id=0 %}";
  let upload_url = "{% url 'column-review' table_id=0 %}";

  function rowSelected(row) {
    // Deselect all other rows
    document.querySelectorAll('.selectable').forEach(function (otherRow) {
      otherRow.classList.remove('selected');
    });

    // Add selected class
    row.classList.add('selected');

    // Update the href and disabled state of the edit and upload buttons based on row selection
    document.querySelector("#edit-link").href = edit_url.replace('0', row.id);
    document.querySelector("#edit-link").removeAttribute("disabled");
    document.querySelector("#upload-link").href = upload_url.replace('0', row.id);
    document.querySelector("#upload-link").removeAttribute("disabled");
  }
</script>

{% endblock content %}